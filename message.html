<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Send a Message — Novel App</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f7; margin:0; padding:20px; }
.card { background: #fff; max-width:500px; margin:auto; padding:20px; border-radius:16px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
h2 { text-align:center; margin-bottom:16px; }
input, textarea, button { width:100%; padding:12px; margin-top:12px; border-radius:12px; border:1px solid #ccc; font-size:1rem; }
button { background:#6200EE; color:#fff; border:none; font-weight:bold; cursor:pointer; }
button:hover { background:#4b1fa5; }
.status { margin-top:12px; font-size:0.95rem; color:green; }
.message-reply { margin-top:12px; font-size:0.95rem; color:#333; padding:10px; background:#eef; border-radius:10px; }
a { display:block; text-align:center; margin-top:14px; text-decoration:none; color:#6200EE; }
</style>
</head>
<body>

<div class="card">
  <h2>Send a Message</h2>

  <input id="subject" placeholder="Subject (optional)">
  <textarea id="message" rows="5" placeholder="Write your message here..." required></textarea>

  <button onclick="sendMessage()">Send Message</button>

  <div class="status" id="status"></div>
  <div class="message-reply" id="replyDisplay"></div>

  <a href="index.html">← Back to Home</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/appwrite@9.0.1"></script>
<script>
const client = new Appwrite.Client()
  .setEndpoint('https://fra.cloud.appwrite.io/v1') // Appwrite endpoint
  .setProject('69702007003c1eaed6f4'); // Project ID

const databases = new Appwrite.Databases(client);
const DATABASE_ID = 'novelpulse_';
const COLLECTION_ID = '6970c672001f68ea0230'; // messages collection

function sendMessage() {
  const subject = document.getElementById('subject').value;
  const message = document.getElementById('message').value;
  const status = document.getElementById('status');
  const replyDisplay = document.getElementById('replyDisplay');

  if (!message) {
    status.innerText = '⚠️ Message cannot be empty';
    return;
  }

  const senderId = 'guest_' + Date.now();
  const recoverId = Appwrite.ID.unique();
  const replyId = '';

  databases.createDocument(
    DATABASE_ID,
    COLLECTION_ID,
    Appwrite.ID.unique(),
    {
      subject: subject,
      message: message,
      createdAt: new Date().toISOString(),
      senderId: senderId,
      replyId: replyId,
      recoverId: recoverId,
      reply: ''
    }
  ).then(doc => {
    status.innerText = '✅ Message sent successfully — the author will reply soon.';
    document.getElementById('subject').value = '';
    document.getElementById('message').value = '';
    replyDisplay.innerText = '⏳ Reply pending';
  }).catch(err => {
    console.error('Appwrite error:', err);
    status.innerText = '❌ Error sending message. Check console.';
  });
}
</script>

</body>
</html>